var objself={};
function library(a,b){this.pagetype=a;this.debug="undefined"==this.getUrlParm("debug")?"":this.getUrlParm("debug");this.gaqEvent="_trackEvent";this.gaqOne=b.baseName;this.gaqTwo=b.pageName;this.srcollflag=!0;this.voteflag=!1;this.saveSrcoll_h=0;this.burl=elex.config.get("baseUrl");this.popleft=0;this.loadicon='<div class="loading" ></div>';this.html='<div class="elexPopup" id="'+a+'" style="display:none;left:'+this.popleft+'px;z-index:99999;"><div class="elexPopupWrap"><div class="popopIco"></div><div class="popopCont">'+this.loadicon+
'</div><div class="popopIco2"></div></div></div>';this.config="undefined"==typeof b?{}:b;this.cacheData={};this.hasimg=b.hasimg;this.imgindex=0;this.me;objself=this}
library.prototype={initialization:function(){if(this.initArr){"true"==this.debug&&elex.log(this.initArr.length);for(i=0;i<this.initArr.length;i++)this.initArr[i]()}},getUrlParm:function(a){var b,c=window.location.search.substring(1);if(0!=c.length){c=c.split("&");for(i=0;i<c.length;i++)if(c[i].split("=")[0]==a){b=c[i].split("=")[1];break}return b}},addOneEvent:function(a){this.initArr.push(a)},addEventGaq:function(a){a[2]="undefined"==typeof a[2]?!0:!1;this.initArr||(this.initArr=[]);this.initArr.push(function(){a[2]?
$(a[0]).click(function(){gaqEventArr=[objself.gaqEvent,objself.gaqOne];"undefined"==typeof gaqEventArr[3]&&(gaqEventArr.push(objself.gaqTwo),gaqEventArr.push(a[1]));_gaq.push(gaqEventArr);if("true"==objself.debug)return!1}):$(a[0]).click(function(){gaqEventArr=[objself.gaqEvent,objself.gaqOne];"undefined"==typeof gaqEventArr[2]&&gaqEventArr.push(a[1]);_gaq.push(gaqEventArr);if("true"==objself.debug)return!1})})},doUpload:function(a){baseurl=this.burl;$(a.id).click(function(){parmData={channelid:a.channelid,
basedid:a.basedid};elex.util.upload(parmData,function(b){"undefined"!=typeof b.url&&(headerUrl=b.url.replace(/original/,"60x60x75x0x0x1"),proUrl=b.url.replace(/original/,"180x180x75x0x0x1"),$(a.id).siblings("img").attr("src",proUrl),$("#headUserImg").attr("src",headerUrl),url=baseurl+"/user/updateprofile",elex.request.post(url,{icon:proUrl},function(){}))})});return this},doLink:function(a){$(a).click(function(){url=$(this).attr("data");"undefined"!=typeof url&&(window.location.href=url)});return this},
dodialogClose:function(){$.dialog.close("pop_"+this.pagetype);return this},doMouseFollow:function(a){"true"==objself.debug&&elex.log(a);dialog=this.pagetype+"_follow";dialog_obj="#"+dialog;a.self.mousemove(function(b){h=$(window).height()+$(window).scrollTop();w=$(window).width()+$(window).scrollLeft();MouseX=b.pageX;MouseY=b.pageY;padMuoseX=20;padMuoseY=30;"undefined"http://337.eleximg.com/337/v3static/js/==typeof a.code?(html=%27<div class="tipsInfro"><img alt="'+a.title+'" src="'+a.img+'" /><p>'+a.title+"</p></div>",warp='<div id="'+
dialog+'" class="dialogPopWarp">'+html+"</div>"):warp='<div id="'+dialog+'" class="dialogPopWarp" style_val>'+a.code+"</div>";md5Str=a.name+a.index;"undefined"==typeof objself.cacheData[elex.md5.val(md5Str)]?("true"==objself.debug&&elex.log(a,0),$("body").append(warp),x=Math.floor(MouseX+padMuoseX+$(dialog_obj).width()>=w?MouseX-$(dialog_obj).width():MouseX),y=Math.floor(MouseY+padMuoseY+$(dialog_obj).height()>=h?MouseY-padMuoseY-$(dialog_obj).height()+10:MouseY+padMuoseY),$(dialog_obj).css({top:y,
left:x}),objself.cacheData[elex.md5.val(md5Str)]=warp):("true"==objself.debug&&elex.log(a,1),html=objself.cacheData[elex.md5.val(md5Str)],0==$(dialog_obj).length?($("body").append(html),x=Math.floor(MouseX+padMuoseX+$(dialog_obj).width()>=w?MouseX-$(dialog_obj).width():MouseX),y=Math.floor(MouseY+padMuoseY+$(dialog_obj).height()>=h?MouseY-padMuoseY-$(dialog_obj).height()+10:MouseY+padMuoseY)):(x=Math.floor(MouseX+padMuoseX+$(dialog_obj).width()>=w?MouseX-$(dialog_obj).width():MouseX),y=Math.floor(MouseY+
padMuoseY+$(dialog_obj).height()>=h?MouseY-padMuoseY-$(dialog_obj).height()+10:MouseY+padMuoseY),$(dialog_obj).css({top:y,left:x})))});a.self.mouseout(function(){$(dialog_obj).remove()});return this},doVote:function(a){"true"==this.debug&&elex.log(a,this.voteflag);if(!0!=this.voteflag)return this.voteflag=!0,url="undefined"http://337.eleximg.com/337/v3static/js/==typeof a.url?this.burl+"/vote/ajax_vote_app/":a.url,numid="undefined"==typeof a.showNum?$("#like_value"):$(a.showNum),data={app_id:a.appid,score:a.score},elex.request.get(url,
data,function(b){if(-1==b.status)return elex.util.login(function(b){0==b.status&&objself.doVote(a)}),objself.voteflag=!1;3!=b.status&&(numid.html(b.like_value+"%"),objself.voteflag=!1);0==a.score?_gaq.push([objself.gaqEvent,objself.gaqOne,objself.gaqTwo,"voted_unlike"]):_gaq.push([objself.gaqEvent,objself.gaqOne,objself.gaqTwo,"voted_like"]);$(a.id).attr("style","filter:Alpha(opacity=30);opacity:0.3;");$(a.id).siblings().attr("style","")}),this},doimgload:function(a){imageObj=new Image;obj1=eval("("+
$(a).find(".photo").attr("data-iconpos")+")");max_w=$(a).find(".photo").width();max_h=$(a).find(".photo").height();imageObj.src=obj1.url;"true"==this.debug&&elex.log(obj1);imageObj.onload=function(){w=imageObj.width;h=imageObj.height;w>max_w&&h<max_h?(load_w=max_w,load_h=load_w*h/w,paddTop=Math.floor((max_h-load_h)/2)):h>max_h&&w<max_w?(load_h=max_h,load_w=load_h*w/h):h>=max_h&&w>=max_w?w/max_w>=h/max_h?(load_w=max_w,load_h=load_w*h/w,paddTop=Math.floor((max_h-load_h)/2)):(load_h=max_h,load_w=load_h*
w/h):(load_h=h,load_w=w,paddTop=Math.floor((max_h-load_h)/2));"true"==this.debug&&elex.log(obj1.url,obj1.name,load_h,load_w,paddTop);$(a).find(".photo").removeClass("elexLoadingfb").html('<img src="'+obj1.url+'" alt="'+obj1.name+'" height="'+load_h+'" wedth="'+load_w+'" style="padding-top:'+("undefined"==typeof paddTop?0:paddTop)+'px;" >')};return this},doimgajaxLoad:function(a){imageObj=new Image;url=a.url;index=this.imgindex+a.score;img_id=a.img_id;elex.request.get(url,{index:index,img_id:img_id},
function(a){0==a.status&&(imageObj.src=a.url,objself.imgindex=a.imgindex,imageObj.onload=imgload())});return this},doimgsilde:function(a){var b=!0;!$(a).find("#prev").length&&!$(a).find("#next").length?(btn=$(a).find(".photo"),text=$(a).find(".text"),status=!1):(!$(a).find("#prev").length||!$(a).find("#next").length?(btn=$(a).find(".btn"),text=$(a).find(".text"),photo=$(a).find(".photo"),photo.mouseover(function(){b&&(btn.find("span").attr("style","opacity:1;filter:alpha(Opacity=100);"),text.slideDown(100))}),
photo.mouseout(function(){btn.find("span").removeAttr("style");setTimeout(function(){b&&text.hide()},100)})):(btn=$(a).find(".btn"),text=$(a).find(".text")),status=!0);var c,d=function(){b&&(!1!=status&&(c.find("span").removeAttr("style"),c.siblings(".btn").find("span").removeAttr("style")),text.hide())};btn.mouseover(function(){b&&(!1!=status&&($(this).find("span").attr("style","opacity:1;filter:alpha(Opacity=100);"),$(this).siblings(".btn").find("span").attr("style","opacity:0.3;filter:alpha(Opacity=30);")),
text.slideDown(100),b=!1,$(this).mouseout(function(){b=!0;c=$(this);setTimeout(function(){d(c)},100)}))});text.mouseover(function(){b=!1});text.mouseout(function(){b=!0;setTimeout(d,100)});return this},dodownMenu:function(a,b,c,d){var e=a.height()-1,f=a.width()+20;a.siblings().find(".menu").hide();menu=a.find(".menu");menu.is(":hidden")&&(menu.css({top:e,left:0,width:f,"z-index":100}).slideDown(200),c&&"true"!=menu.attr("data-ajax")&&(menu.find("a").click(function(){menu.find("a").removeClass("active");
$(this).addClass("active");objself.dodownMenuGetData($(this),d,$("#js_library_home_content"));menu.hide();return!1}),menu.attr("data-ajax",!0)),a=b||window.event,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,setTimeout(function(){$(document.body).one("click",function(){menu.hide()})},10));return this},dodownMenuGetData:function(a,b,c){c.height();"true"==this.debug&&elex.log(a);var d=a.attr("data-ajax"),e=a.html();a.closest(".menu").siblings(".input").children("span").attr("data-ajax",d).html(e);
d=a.closest("#js_category_select").find(".list").length;e={};for(i=0;i<d;i++)key=a.closest("#js_category_select").find(".list").eq(i).attr("id").split("_")[1],e[key]=a.closest("#js_category_select").find(".list .input span").eq(i).attr("data-ajax");"true"==this.debug&&elex.log(e);c.css("height",250).html("").addClass("elexLoadingfb");elex.request.get(b,e,function(a){0==a.status&&(c.removeAttr("style").removeClass("elexLoadingfb"),c.html(a.html))});return this},doSearch:function(a,b,c){"true"==this.debug&&
elex.log(a,b,c);keywords=encodeURI($(a).val());""!=keywords&&($(b).css("height",250).html("").addClass("elexLoadingfb"),elex.request.get(c,{keyword:keywords},function(a){0==a.status&&($(b).removeAttr("style").removeClass("elexLoadingfb"),$(b).html(a.html))}))}};
